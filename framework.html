<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <script src="tracery.js"></script>

  </head>
  <body>
    <script src="./plot_arc.js"></script>
    <script src="./select.js"></script>
    <script src="./grammars/eventer.js"></script>
    
    <div id="testing"></div>
    <div id="output"></div>
    <script src="./framework.js"></script>
    <script>
      function loadJSON(callback, file, accumulator) {

          var xobj = new XMLHttpRequest();
              xobj.overrideMimeType("application/json");
          xobj.open('GET', 'grammars/'+file+'.json', true);
          xobj.onreadystatechange = function () {
                if (xobj.readyState == 4 && xobj.status == "200") {
                  // Required use of an anonymous callback as .open
                  // will NOT return a value but simply returns undefined
                  // in asynchronous mode
                  callback({...accumulator,
                            ...JSON.parse(xobj.responseText)});
                }
          };
          xobj.send(null);  
      }
      
      // You can load your results as a variable from a JavaScript file...
      //displayResults(plot_rules, "output");

      function main(rules) {
        //displayResults('testing', rules);
        displayResults('output', rules);
      }
      loadJSON((rules) =>
      loadJSON((rules) =>
      loadJSON((rules) =>
        loadJSON((rules) =>
          loadJSON((rules) =>
            loadJSON(main, 'landscape_desc', rules),
          'roads_travel', rules),
          'desc_clothing', rules),
          'town_desc', rules),
          'journey_rules', rules),
          'things_desc', {})


      // ...or from a JSON file:
      //loadJSON(function(json_response) {
      //  displayResults(JSON.parse(json_response), "output");
      //}, "./grammars/test_grammar.json");

      /* function partial(func, ...argsBound) {
        return function(...args) { // (*)
          return func.call(this, ...argsBound, ...args);
        }
      } */

    </script>
    <div id="visualization" style="">
    </div>
  </body>
</html>
